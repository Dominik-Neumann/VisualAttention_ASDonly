---
title: "Visual attention to neutral vs competing vs reinforcing stimuli among children with ASD"
output: html_notebook
---
<b>Author: Dominik Neumann</b><br>
Michigan State University

```{r global_options, include = FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

# Setup
Please select "dat_visualattention.csv" for dat_attention data table and "dat_master.csv" for dat_master data table in order to run this script properly. <br>
Missing values were coded as -999. We coded “-“ values as -888, indicating participants looked at the center of the screen and thus at neither distracter nor target. We coded “.” values as -777, indicating participants looking outside of the screen.
```{r results = FALSE}
### OPTIONS
options(scipen = 3)

### LOADING PACKAGES
# General libraries
library(tidyverse)
library(psych)
library(plyr)

# Multilevel modeling
library(lme4)
library(nlme)
library(ez)
library(multcomp)
library(TTR)
library(lmerTest)
library(powerlmm)
library(lsmeans)
library(car)

# ANOVA
library(knitr)
library(sjstats)

### FUNCTIONS
# APA style charts
apatheme <- theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(),
        text = element_text(family = 'Times'))

# Function that counts the number if NA's in a given row:
countNA <- function(df)
  apply(df, MARGIN = 1, FUN = function(x) length(x[is.na(x)]))

### DATA
# Loading gaze data
dat_attention <- read.csv(file.choose())
dat_master <- read.csv(file.choose())

# Recoding '-999', '-888', and '-777' to missing values 'NA'
dat_attention[dat_attention == -999 | dat_attention == -888 | dat_attention == -777] <- NA
```

There are 58 participants in this study that have been diagnosed with Autism Syndrom Disorder (ASD). All conditions were administered within participants, with ten trials per condition.
```{r results = FALSE}
# We were only interested in participants with with Autism Syndrom Disorder
dat_attention$Child_ID <- factor(dat_attention$Child_ID)
dat_attention <-dat_attention %>%
  dplyr::filter(Child_Type == "ASD")
nrow(count(unique(dat_attention$Child_ID)))
```

# Data cleaning and transforming
```{r}
# Drop columns before and after the analysis window (3200 = frame 97, 4900 = frame 148)
dat_attention_analysiswindow <- subset(dat_attention, select = -c(frame_001:frame_096, frame_149:frame_237))
```

## Missing values and underperforming trials
Our critical window is from 300 to 2000 ms after the onset of the target word. Trials on which children were not fixating either object for more than 50% of the critical window were excluded. These trials do not have adequate data. In sum, there were 1,313 trials. Of these, 397 (~30%) had more than 50% missing data. After exclusion, therefore, used 916 trials.
```{r results = FALSE}
### TRIAL-WISE DELETION
# Count number of rows before deleting trials with more than 50% missing values
nrow(dat_attention_analysiswindow)
# Apply function countNA (see in "Functions") to critical dataset and exclude all rows with more than (number of variables divided by two) NAs between frame_097 and frame_148
dat_attention_analysiswindowNA <- dat_attention_analysiswindow[countNA(subset(dat_attention_analysiswindow,
                                                                              select = frame_097:frame_148)) < (ncol(subset(dat_attention_analysiswindow,
                                                                                                                            select = frame_097:frame_148))/2),]
# Count number of rows after deleting trials with more than 50% missing values
nrow(dat_attention_analysiswindowNA)
nrow(dat_attention_analysiswindow) - nrow(dat_attention_analysiswindowNA)
(nrow(dat_attention_analysiswindow) - nrow(dat_attention_analysiswindowNA)) / (nrow(dat_attention_analysiswindow))
```
<b>Table 1</b> Number of trials after excluding trials with more than 50% missingness
```{r}
Process <- c("Before cleaning", "Number of excluded trials", "After cleaning")
n <- c(1313, 397, 916)
number_of_observations <- cbind(Process, n)
as.data.frame(number_of_observations)
```

```{r results = FALSE}
### PARTICIPANT-WISE DELETION
# Counting number of trials within conditions for each participant before exclusion
kidsxconditiontable <- count(dat_attention_analysiswindowNA, c("Child_ID", "Condition"))
nrow(kidsxconditiontable)

# Excluding participant who were contributing to little
id_for_exclusion <- c("8016", "8022", "8047", "8049", "8057", "8058", "8059", "8062", "8063", "8072", "8076", "8077")
dat_attention_analysiswindowNA <- dat_attention_analysiswindowNA[ ! dat_attention_analysiswindowNA$Child_ID %in% id_for_exclusion, ]

# Counting number of trials within conditions for each participant after exclusion
kidsxconditiontable1 <- count(dat_attention_analysiswindowNA, c("Child_ID", "Condition"))
nrow(kidsxconditiontable1)

```